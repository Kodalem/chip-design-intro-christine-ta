# Week 6 Exercise  
*Open Source Chip Design Course*  
*July 2024*
---


## Introduction
This is a special week as it is the last of these weekly assignments, you must complete the Hand-in Assignment and find a group for next week where you can begin your final project.

Firstly this weeks Hand-in Assignment is presented and then the project is presented.

## Hand-in Assignment
This shall be handed in before next week. You should submit a document (preferably LaTeX) that answers the following questions.

### 1. Exploring the layout
In this assignment, you will be exploring the layout generated by OpenLane2. You are required to visit and read the following page: [OpenLane2 Configuration Reference](https://openlane2.readthedocs.io/en/latest/reference/configuration.html).
You should explore the 7-seqment display you made last week.

1. Open the KLayout viewer using make.
   You are now expected to show the power strips; you may disable or enable viewable layers in the "Layers." You can use "Hide all" and then the metal layer in which the power strips reside. They are called "met*.drawing."
   Display the power strips in your assignment.
2. Describe what a power strip is.
3. Locate the signal pins; these also reside on a metal layer. You shall outline the pins in a program like *Paint* or *GIMP*.
4. How big are the pins? (you must meassure them)
7. Describe what die area is.




## Assignment
You must find a team of 2-3 people to complete the project.

### Mandelbrot Set VGA Displayer
The Mandelbrot set is an iconic computation. It is the set of all number which converges in the eqaution:
Zn+1 = Zn^2 + C
Where Z0 = 0
Any complex number C that is part of the Mandelbrot set will not tend towards infinity as the number of iterations increases.

This project consists of two parts, firstly You must create a structure that determines whether a complex number is stable or unstable, you may assume it is stable if has not gone outside the stability circle in X iterations where X is equal or greater then 8.
If the number is unstable you must color it with some color other then black, if it is stable you must color it black.

Secondly you must create a way to interface with the VGA controller [Tiny VGA](https://github.com/mole99/tiny-vga). You may use 16-bit or 32-bit fixed point representation, 16-bit, 32-bit IEEE 754 floating point representation or any other floating point representation.
It is recommended to start with a fixed point representation.

You may use the visual tool to check if you design displays correctly [VGA simulation](https://github.com/SamanMohseni/VGA-Simulation) or the Chisel test which is provided.
You may also use [VGA Playground](https://vga-playground.com/), but at the time of writing it does not always simulate correctly.

The output pins should be assigned:
```
assign uo_out = {hsync, B[0], G[0], R[0], vsync, B[1], G[1], R[1]};
```
Where R0, G0, B0 are the least significant bits and R1, G1, B1 are the most significant bits.

You may assume that a 100 MHz clock will be advaliable, and the VGA output is clocked at 25Mhz. You will therefor have 4 clock cycles per pixel output. 
You should perform a minimum of 2 iterations per clock cycle.


### 1. Explain Mandelbrot
1. Explain how Mandelbrot is calculated and evaluated.
2. You are using a limited number of iterations to find the if a point is inside or outside of the Mandelbrot set. How does this affect the appearance of the Mandelbrot set?
3. You are using a limited precision (the fractional number of bits) to represent a point. How does this affect the appearance of the Mandelbrot set?
4. You are using a limited range to in your number represention. How does this affect the appearance of the Mandelbrot set?
5. Why do computer-generated Mandelbrot sets not exhibit these issues?

### 2. Design
You must:
1. Provide working Chisel/Verilog code.
2. Show that the project works by tests and simulating. The Simulations should be displayed using GTK-wave.
3. Provide an in-depth tour of the design and your ideas.
4. Provide an overview of the physical design.
5. Pass all the github actions tests.

You must answer:
6. What is the max clock frequency you can operate at. (Approximately)
7. What is the limiting factor (for increasing clock frequency) area or speed? and can you trade one for the other.
8. How much power do you consume?
9. How many tiles do you need? (should be somewhere around 4 tinytapeout tiles)
10. How many multiplier do you need to do 2 iterations per clock cycle?
11. How many bits do you use for fractional bits and why? (if you are using floating point you may skip this.)
12. How do you convert from screen space coordinates to the real and imaginary number lines.

The project should be in a state where it should be possiable for you to commit it to tinytapeout and you should be quite sure the project would work.

Some optional additions are listed, but feel free to come up with your own ideas.
- Color: Color the set based on level of unstability (iterations).
- Zoom: Allow the ability to zoom using button inputs. (using buttons)
- Move: Allow the ability to move the point of view using button inputs. (using buttons)


### 3. Exploring design contrants and parameters
You are expected to explore the openlane2 GUI to answer the following questions. 

1. In the openlane GUI find the resistance of the metal 1, 3 and 5. Do they differ and why?
2. Find the capacitance of metal 1, 2, 3, 4 and 5, give a reasoning for why they are different.
3. Ponder on what the capatance of the different metal layers couble to, you do not have to be correct here, but your argumentation should be sound.
4. What is edge capacitance?
5. What is the minimum area of metal 2, 4 and 5.
6. Give a describtion of why there is a minimum area, why can't you just make it smaller? (this is releated to the fabrication process of ICs)
7. what is the resistance of via 1, 2, 3, 4 and 5.
8. Find pin "uo_out[3]", "uo_out[7]" and "uio_out[4]", povide an image and comment if you see something interesting.
9. Estimate the resistence from the edge of the design down to a gate in the center of your design, assume perfect voltage source at the edge of the design.
10. Disable "physical instances" and "nets" to observed the space taken up by your logic cells. Provide an image a some comments.
11. Find and go to "12-openroad-staprepnr/summary.rpt" to see "Reg to Reg paths" and "Setup	Worst Slack" report your findings. 
12. Find and go to "openroad-globalplacementskipio.log" to see utilization procentage, report your findings.


### 4. Notes and help
You might want to visit [VGA spec](http://javiervalcarce.eu/html/vga-signal-format-timming-specs-en.html) and [Tiny VGA spec](http://www.tinyvga.com/vga-timing/640x480@60Hz), this is explains the VGA protocol, but note that you will not be interfacing directly with the VGA protocol, but rather the [Tiny VGA](https://github.com/mole99/tiny-vga), which is a somewhat simplified version. You will only have 2 bit of color per channel.

I would recommend that you write first write a purely combinatoric version of a Mandelbrot simulator and then afterwards you may make it more compicated but dividing the computation over multiple clock cycles.
I would also recommend that you write the code in a way that allows you to change the number of bits you operate with, you may want to try different configuration of fractional bit.

You can find a "DisplayTester.scala" and "VgaSyncGenerator.scala" which will help you get started. The "DisplayTester.scala" will output an image with the resulting image.
The VgaSyncGenerator generates the VGA sync singals required to correctly control the screen. 

You will likely experience with Chisel3 and verilator, you should have a look at [Chisel Lowering Options](https://github.com/llvm/circt/blob/main/include/circt/Support/LoweringOptions.h) to find options to resolve these.
Take at look at disallowPackedArrays and disallowLocalVariables.

If you are using a fixed-point representation it should represent the range -2 to 2 for both the real and complex part, you do not have to represent a greater range as any number which goes outside the range 2,-2 will not be a part of Mandelbrot set, you are however required to handle overflow.

A note on using TinyTapeout and openlane2: When you view your design in openlane2, you are not viewing the extect same that would be commited to TinyTapeout, you are just viewing a implementation of the circuit. 
The design implementation might change if you where to submit it to TinyTapeout, so all analysis you do in your local openlane2 installation should be taken as a approximation of what would be fabricated by TinyTapeout. 

You can use the following projects to display your final GDS file: [GDS2glTF](https://github.com/TinyTapeout/GDS2glTF) and [GDS_viewer](https://github.com/TinyTapeout/tinytapeout_gds_viewer).
